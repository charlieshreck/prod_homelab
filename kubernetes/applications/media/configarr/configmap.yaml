apiVersion: v1
kind: ConfigMap
metadata:
  name: configarr-config
  namespace: media
data:
  config.yml: |
    trashGuideUrl: https://github.com/TRaSH-Guides/Guides
    recyclarrConfigUrl: https://github.com/recyclarr/config-templates

    sonarr:
      main:
        base_url: http://sonarr.media.svc.cluster.local:8989
        api_key: !env SONARR_API_KEY

        quality_definition:
          type: series

        include:
          - template: sonarr-quality-definition-series

        # Quality size limits (MB per minute of runtime)
        # 45min episode at 60 MB/min = ~2.7GB, at 35 MB/min = ~1.5GB
        quality_sizes:
          - quality: WEBDL-1080p
            min: 5
            preferred: 25
            max: 35
          - quality: WEBRip-1080p
            min: 5
            preferred: 25
            max: 35
          - quality: Bluray-1080p
            min: 10
            preferred: 35
            max: 50
          - quality: WEBDL-2160p
            min: 10
            preferred: 40
            max: 60
          - quality: WEBRip-2160p
            min: 10
            preferred: 40
            max: 60
          - quality: Bluray-2160p
            min: 20
            preferred: 60
            max: 80

        quality_profiles:
          - name: "4K HEVC + 1080p Fallback"
            reset_unmatched_scores:
              enabled: true
            upgrade:
              allowed: true
              until_quality: WEB 2160p
              until_score: 10000
            min_format_score: 0
            qualities:
              - name: WEB 2160p
                qualities:
                  - WEBDL-2160p
                  - WEBRip-2160p
              - name: Bluray-2160p
              - name: WEB 1080p
                qualities:
                  - WEBDL-1080p
                  - WEBRip-1080p
              - name: Bluray-1080p
              - name: HDTV-1080p

        # GPU Hardware Transcoding Compatibility (Quadro P4000)
        # AV1: P4000 has no AV1 decode hardware
        # x265 (HD): Block x265 at 1080p - x264 preferred for compatibility, P4000 transcodes x264 efficiently
        # x265 (no HDR/DV): Block 4K x265 without HDR/DV - SDR x265 at 4K is undesirable
        custom_formats:
          - trash_ids:
              - 15a05bc7c1a36e2b57fd628f8977e2fc  # AV1
            assign_scores_to:
              - name: "4K HEVC + 1080p Fallback"
                score: -10000
          - trash_ids:
              - 47435ece6b99a0b477caf360e79ba0bb  # x265 (HD)
            assign_scores_to:
              - name: "4K HEVC + 1080p Fallback"
                score: -10000
          - trash_ids:
              - 839bea857ed2c0a8e084f3cbdbd65ecb  # x265 (no HDR/DV)
            assign_scores_to:
              - name: "4K HEVC + 1080p Fallback"
                score: -10000

        # Block dangerous/malware file extensions
        # These should never appear in legitimate media releases
        custom_formats_own:
          - name: "Block Dangerous Extensions"
            includeCustomFormatWhenRenaming: false
            specifications:
              - name: "EXE files"
                implementation: "ReleaseTitleSpecification"
                negate: false
                required: false
                fields:
                  value: "\\.exe$"
              - name: "MSI files"
                implementation: "ReleaseTitleSpecification"
                negate: false
                required: false
                fields:
                  value: "\\.msi$"
              - name: "BAT files"
                implementation: "ReleaseTitleSpecification"
                negate: false
                required: false
                fields:
                  value: "\\.bat$"
              - name: "SCR files"
                implementation: "ReleaseTitleSpecification"
                negate: false
                required: false
                fields:
                  value: "\\.scr$"
            assign_scores_to:
              - name: "4K HEVC + 1080p Fallback"
                score: -10000

    radarr:
      main:
        base_url: http://radarr.media.svc.cluster.local:7878
        api_key: !env RADARR_API_KEY

        quality_definition:
          type: movie
          preferred_ratio: 0.0

        include:
          - template: radarr-quality-definition-movie

        quality_profiles:
          - name: "4K HEVC + 1080p Fallback"
            reset_unmatched_scores:
              enabled: true
            upgrade:
              allowed: true
              until_quality: Bluray-2160p
              until_score: 10000
            min_format_score: 0
            qualities:
              # 4K tier (no Remux - too large)
              - name: Bluray-2160p
              - name: WEB 2160p
                qualities:
                  - WEBDL-2160p
                  - WEBRip-2160p
              # 1080p fallback tier (no Remux - too large)
              - name: Bluray-1080p
              - name: WEB 1080p
                qualities:
                  - WEBDL-1080p
                  - WEBRip-1080p

        # File size ranges - tighter limits for storage efficiency
        # For a 2hr movie: 35 GB max for 4K WEB, 15 GB max for 1080p WEB
        quality_sizes:
          - quality: WEBDL-1080p
            min: 3
            preferred: 10
            max: 15
          - quality: WEBRip-1080p
            min: 3
            preferred: 10
            max: 15
          - quality: Bluray-1080p
            min: 5
            preferred: 15
            max: 25
          - quality: WEBDL-2160p
            min: 10
            preferred: 25
            max: 35
          - quality: WEBRip-2160p
            min: 10
            preferred: 25
            max: 35
          - quality: Bluray-2160p
            min: 15
            preferred: 35
            max: 50

        # GPU Hardware Transcoding Compatibility (Quadro P4000)
        # AV1: P4000 has no AV1 decode hardware
        # x265 (HD): Block x265 at 1080p - x264 preferred for compatibility, P4000 transcodes x264 efficiently
        # x265 (no HDR/DV): Block 4K x265 without HDR/DV - SDR x265 at 4K is undesirable
        custom_formats:
          - trash_ids:
              - cae4ca30163749b891686f95532519bd  # AV1
            assign_scores_to:
              - name: "4K HEVC + 1080p Fallback"
                score: -10000
          - trash_ids:
              - dc98083864ea246d05a42df0d05f81cc  # x265 (HD)
            assign_scores_to:
              - name: "4K HEVC + 1080p Fallback"
                score: -10000
          - trash_ids:
              - 839bea857ed2c0a8e084f3cbdbd65ecb  # x265 (no HDR/DV)
            assign_scores_to:
              - name: "4K HEVC + 1080p Fallback"
                score: -10000

        # Block dangerous/malware file extensions
        custom_formats_own:
          - name: "Block Dangerous Extensions"
            includeCustomFormatWhenRenaming: false
            specifications:
              - name: "EXE files"
                implementation: "ReleaseTitleSpecification"
                negate: false
                required: false
                fields:
                  value: "\\.exe$"
              - name: "MSI files"
                implementation: "ReleaseTitleSpecification"
                negate: false
                required: false
                fields:
                  value: "\\.msi$"
              - name: "BAT files"
                implementation: "ReleaseTitleSpecification"
                negate: false
                required: false
                fields:
                  value: "\\.bat$"
              - name: "SCR files"
                implementation: "ReleaseTitleSpecification"
                negate: false
                required: false
                fields:
                  value: "\\.scr$"
            assign_scores_to:
              - name: "4K HEVC + 1080p Fallback"
                score: -10000
