apiVersion: v1
kind: ConfigMap
metadata:
  name: homeassistant-configuration
  namespace: apps
data:
  configuration.yaml: |
    # Loads default set of integrations. Do not remove.
    default_config:

    # Home Assistant configuration
    homeassistant:
      external_url: https://homeassistant.kernow.io
      internal_url: http://homeassistant.apps.svc.cluster.local:8123

    # HTTP Configuration
    http:
      use_x_forwarded_for: true
      trusted_proxies:
        - 10.244.0.0/16

    # MQTT Binary Sensors - Motion Sensors
    mqtt:
      binary_sensor:
        - name: "Front Door Motion Sensor"
          state_topic: 'tele/rfbridge/RESULT'
          value_template: '{{value_json.RfReceived.Data}}'
          payload_on: "B5ED66"
          payload_off: "B5ED66off"
          device_class: motion
          qos: 1
          off_delay: 10

        - name: "Garage Motion Sensor"
          state_topic: 'tele/rfbridge/RESULT'
          value_template: '{{value_json.RfReceived.Data}}'
          payload_on: "FCF566"
          payload_off: "FCF566off"
          device_class: motion
          qos: 1
          off_delay: 10

    # Matter Server Integration
    # NOTE: Matter integration must be configured via UI (Settings -> Devices & Services)
    # Add integration: Matter (BETA)
    # WebSocket URL: ws://matter-server.apps.svc.cluster.local:5580/ws
    # Bridge mode and filters are configured in the UI after setup

    # Text to speech
    tts:
      - platform: google_translate

    automation: !include automations.yaml
    script: !include scripts.yaml
    scene: !include scenes.yaml
