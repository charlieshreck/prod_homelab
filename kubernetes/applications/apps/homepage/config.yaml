apiVersion: v1
kind: ConfigMap
metadata:
  name: homepage
  namespace: apps
  labels:
    app.kubernetes.io/name: homepage
data:
  kubernetes.yaml: |
    mode: cluster
    clusters:
      - name: production
        url: https://10.10.0.40:6443
      - name: monitoring
        url: https://10.10.0.30:6443
        serviceAccountToken: /app/monitoring/token
        certificate: /app/monitoring/ca
      - name: agentic
        url: https://10.20.0.40:6443
        serviceAccountToken: /app/agentic/token
        certificate: /app/agentic/ca

  settings.yaml: |
    title: Kernow Homelab
    background:
      image: https://images.unsplash.com/photo-1502790671504-542ad42d5189?auto=format&fit=crop&w=2560&q=80
      blur: sm
      saturate: 50
      brightness: 50
      opacity: 50
    cardBlur: md
    theme: dark
    color: slate
    headerStyle: clean
    statusStyle: dot
    iconStyle: theme
    useEqualHeights: true
    hideErrors: true
    target: _blank
    quicklaunch:
      searchDescriptions: true
      hideInternetSearch: false
      showSearchSuggestions: true
      hideVisitURL: false
      provider: google
    layout:
      Media:
        tab: Services
        icon: mdi-filmstrip
        style: row
        columns: 4
      Home Services:
        tab: Services
        icon: mdi-home-automation
        style: row
        columns: 3
      Agentic:
        tab: Services
        icon: mdi-robot
        style: row
        columns: 3
      Infrastructure:
        tab: Infrastructure
        icon: mdi-server-network
        style: row
        columns: 4
      Kubernetes:
        tab: Infrastructure
        icon: mdi-kubernetes
        style: row
        columns: 3
      Storage:
        tab: Infrastructure
        icon: mdi-database
        style: row
        columns: 3
      Backups:
        tab: Infrastructure
        icon: mdi-backup-restore
        style: row
        columns: 2
      Monitoring:
        tab: Monitoring
        icon: mdi-chart-line
        style: row
        columns: 4
      Documentation:
        tab: Services
        icon: mdi-book-open-variant
        style: row
        columns: 3
      Platform Services:
        tab: Platform
        icon: mdi-cog
        style: row
        columns: 3

  bookmarks.yaml: |
    - Developer:
        - GitHub (Prod):
            - abbr: GH
              icon: github.png
              href: https://github.com/charlieshreck/prod_homelab
        - GitHub (Agentic):
            - abbr: GA
              icon: github.png
              href: https://github.com/charlieshreck/agentic_lab
        - GitHub (Monit):
            - abbr: GM
              icon: github.png
              href: https://github.com/charlieshreck/monit_homelab
        - GitHub (MCP Servers):
            - abbr: MC
              icon: github.png
              href: https://github.com/charlieshreck/mcp-servers

    - Management:
        - Cloudflare:
            - abbr: CF
              icon: cloudflare.png
              href: https://dash.cloudflare.com/
        - Infisical:
            - abbr: IS
              icon: infisical.png
              href: https://app.infisical.com/
        - Traefik Dashboard:
            - abbr: TF
              icon: traefik.png
              href: https://traefik.kernow.io/dashboard/

    - AI & APIs:
        - OpenRouter:
            - abbr: OR
              icon: mdi-api
              href: https://openrouter.ai/
        - Anthropic Console:
            - abbr: AN
              icon: mdi-brain
              href: https://console.anthropic.com/
        - Google AI Studio:
            - abbr: AI
              icon: mdi-google
              href: https://aistudio.google.com/

    - Networking:
        - Tailscale:
            - abbr: TS
              icon: tailscale.png
              href: https://login.tailscale.com/admin
        - Cloudflare Zero Trust:
            - abbr: ZT
              icon: cloudflare-zero-trust.png
              href: https://one.dash.cloudflare.com/

    - Communication:
        - Element Web:
            - abbr: EL
              icon: element.png
              href: https://app.element.io/#/login
        - Matrix:
            - abbr: MX
              icon: matrix.png
              href: https://matrix.kernow.io

    - Documentation:
        - Homepage Docs:
            - abbr: HP
              icon: homepage.png
              href: https://gethomepage.dev/

    - Media:
        - Plex Web:
            - abbr: PX
              icon: plex.png
              href: https://app.plex.tv
        - Overseerr:
            - abbr: OS
              icon: overseerr.png
              href: https://overseerr.kernow.io
        - Tautulli:
            - abbr: TT
              icon: tautulli.png
              href: https://tautulli.kernow.io

  services.yaml: |
    # Services are automatically discovered via ingress annotations
    # Manual entries below for services requiring widgets or not auto-discovered

    - Media:
        - Plex:
            icon: plex.png
            href: https://plex.kernow.io
            description: Media Server (GPU Transcoding)
            widget:
              type: plex
              url: http://10.10.0.50:32400
              key: "{{HOMEPAGE_VAR_PLEX_TOKEN}}"
              fields:
                - streams
                - movies
                - tv

    - Infrastructure:
        - Proxmox (Ruapehu):
            icon: proxmox.png
            href: https://proxmox.kernow.io
            description: Primary Hypervisor
            widget:
              type: proxmox
              url: https://10.10.0.10:8006
              username: root@pam!homepage
              password: "{{HOMEPAGE_VAR_API_TOKEN}}"
              node: Ruapehu

        - Proxmox (Pihanga):
            icon: proxmox.png
            href: https://proxmox.monit.kernow.io
            description: Monitoring + Backup Host
            widget:
              type: proxmox
              url: https://10.10.0.20:8006
              username: root@pam!homepage
              password: "{{HOMEPAGE_VAR_PIHANGA_API_TOKEN}}"
              node: Pihanga

        - Proxmox (Hikurangi):
            icon: proxmox.png
            href: https://proxmox.cortex.kernow.io
            description: Agentic Control Hub
            widget:
              type: proxmox
              url: https://10.30.0.10:8006
              username: mcp@pve!mcp-token
              password: "{{HOMEPAGE_VAR_HIKURANGI_API_TOKEN}}"
              node: Hikurangi

        - OPNsense:
            icon: opnsense.png
            href: https://opnsense.kernow.io
            description: Firewall & Router
            widget:
              type: opnsense
              url: https://10.10.0.1:8443
              username: "{{HOMEPAGE_VAR_OPNSENSE_API_KEY}}"
              password: "{{HOMEPAGE_VAR_OPNSENSE_API_SECRET}}"
              wan: opt4
              fields:
                - cpu
                - memory
                - wanUpload
                - wanDownload

        - AdGuard Home:
            icon: adguard-home.png
            href: https://adguard.kernow.io
            description: DNS & Ad Blocking
            widget:
              type: adguard
              url: http://10.10.0.1:3000
              username: "{{HOMEPAGE_VAR_ADGUARD_USERNAME}}"
              password: "{{HOMEPAGE_VAR_ADGUARD_PASSWORD}}"
              fields:
                - queries
                - blocked
                - filtered
                - latency

        - UniFi Network:
            icon: unifi.png
            href: https://unifi.kernow.io
            description: Network Controller
            widget:
              type: unifi
              url: https://10.10.0.51:11443
              username: "{{HOMEPAGE_VAR_UNIFI_USERNAME}}"
              password: "{{HOMEPAGE_VAR_UNIFI_PASSWORD}}"
              fields:
                - uptime
                - wlan
                - wlan_users
                - wlan_devices

        # Backrest now auto-discovered via ingress annotation with widget

    # Monitoring cluster services - manual config with kubernetes status
    - Monitoring:
        - Grafana:
            icon: grafana.png
            href: https://grafana.kernow.io
            description: Metrics Dashboards
            server: monitoring
            app: grafana
            namespace: monitoring

        - Prometheus:
            icon: prometheus.png
            href: https://prometheus.monit.kernow.io
            description: Metrics Collection
            server: monitoring
            app: prometheus
            namespace: monitoring
            widget:
              type: prometheus
              url: https://prometheus.monit.kernow.io

        - VictoriaMetrics:
            icon: victoriametrics.png
            href: https://victoriametrics.monit.kernow.io
            description: Time Series Database
            server: monitoring
            app: victoria-metrics-single
            namespace: monitoring

        - VictoriaLogs:
            icon: victoriametrics.png
            href: https://victorialogs.monit.kernow.io
            description: Log Aggregation
            server: monitoring
            app: victoria-logs-single
            namespace: monitoring

        - AlertManager:
            icon: alertmanager.png
            href: https://alertmanager.monit.kernow.io
            description: Alert Routing
            server: monitoring
            app: alertmanager
            namespace: monitoring

        - Gatus:
            icon: mdi-check-circle
            href: https://gatus.kernow.io
            description: Health Checks
            server: monitoring
            podSelector: "app=gatus"
            namespace: monitoring
            widget:
              type: gatus
              url: https://gatus.kernow.io

        - Coroot:
            icon: mdi-chart-line
            href: https://coroot.kernow.io
            description: eBPF Observability
            server: monitoring
            podSelector: "app.kubernetes.io/component=coroot"
            namespace: coroot

        - ntopng:
            icon: ntopng.png
            href: https://ntopng.kernow.io
            description: Network Traffic Analysis
            widget:
              type: customapi
              url: http://10.10.0.1:3001/lua/rest/v2/get/interface/data.lua?ifid=1
              username: admin
              password: "{{HOMEPAGE_VAR_NTOPNG_PASSWORD}}"
              refreshInterval: 10000
              mappings:
                - field: rsp.num_hosts
                  label: Hosts
                  format: number
                - field: rsp.num_flows
                  label: Flows
                  format: number
                - field: rsp.throughput_bps
                  label: Throughput
                  format: number
                - field: rsp.engaged_alerts
                  label: Alerts
                  format: number

        - Beszel:
            icon: mdi-server
            href: https://beszel.kernow.io
            description: Host Monitoring
            server: monitoring
            podSelector: "app=beszel"
            namespace: monitoring
            widget:
              type: beszel
              url: https://beszel.kernow.io
              username: "{{HOMEPAGE_VAR_BESZEL_USERNAME}}"
              password: "{{HOMEPAGE_VAR_BESZEL_PASSWORD}}"
              version: 2

    - Kubernetes:
        - Talos Control Plane:
            icon: talos.png
            description: Control Plane Node
            proxmoxNode: Ruapehu
            proxmoxVMID: 400

        - Talos Worker 01:
            icon: talos.png
            description: Worker Node 1
            proxmoxNode: Ruapehu
            proxmoxVMID: 401

        - Talos Worker 02:
            icon: talos.png
            description: Worker Node 2
            proxmoxNode: Ruapehu
            proxmoxVMID: 402

        - Talos Worker 03:
            icon: talos.png
            description: Worker Node 3
            proxmoxNode: Ruapehu
            proxmoxVMID: 403

        - Talos Monitor:
            icon: talos.png
            description: Monitoring Cluster
            proxmoxNode: Pihanga
            proxmoxVMID: 200

        - Talos Agentic:
            icon: talos.png
            description: Agentic AI Cluster
            ping: https://10.20.0.40:6443

    - Storage:
        - TrueNAS Media:
            icon: truenas.png
            href: https://truenas.kernow.io
            description: NVMe Media Storage
            widget:
              type: truenas
              url: https://10.20.0.100
              key: "{{HOMEPAGE_VAR_TRUENAS_MEDIA_API_KEY}}"

        - TrueNAS HDD:
            icon: truenas.png
            href: https://truenas.hdd.kernow.io
            description: HDD Bulk Storage
            widget:
              type: truenas
              url: https://10.20.0.103
              key: "{{HOMEPAGE_VAR_TRUENAS_HDD_API_KEY}}"

    # Agentic cluster services - manual config with kubernetes status
    - Agentic:
        - Afferent:
            icon: mdi-cellphone-link
            href: https://synapse.kernow.io
            description: Claude Code Mobile PWA
            ping: https://synapse.kernow.io

        - Matrix:
            icon: matrix.png
            href: https://matrix.kernow.io
            description: Matrix/Conduit Server
            server: agentic
            podSelector: "app=conduit"
            namespace: ai-platform

        - LangGraph:
            icon: mdi-graph
            href: https://langgraph.kernow.io
            description: AI Orchestration
            server: agentic
            podSelector: "app=langgraph"
            namespace: ai-platform

    - Documentation:
        - Outline:
            icon: outline.png
            href: https://outline.kernow.io
            description: Wiki & Knowledge Base
            server: agentic
            app: outline
            namespace: ai-platform

        - SilverBullet:
            icon: silverbullet.png
            href: https://silverbullet.kernow.io
            description: Markdown PKM
            server: agentic
            podSelector: "app=silverbullet"
            namespace: ai-platform

        - Vikunja:
            icon: vikunja
            href: https://vikunja.kernow.io
            description: Task & Project Management
            server: agentic
            podSelector: "app=vikunja"
            namespace: vikunja

    - Backups:
        - Backrest:
            icon: mdi-backup-restore
            href: https://backrest.kernow.io
            description: Restic Backup Manager
            server: agentic
            podSelector: "app=backrest"
            namespace: backrest
            widget:
              type: backrest
              url: https://backrest.kernow.io
              username: "{{HOMEPAGE_VAR_BACKREST_USERNAME}}"
              password: "{{HOMEPAGE_VAR_BACKREST_PASSWORD}}"

        - Garage:
            icon: mdi-garage
            href: https://garage.kernow.io
            description: S3-Compatible Storage
            # Garage runs outside k8s, no kubernetes status available

        - PBS:
            icon: proxmox.png
            href: https://pbs.kernow.io
            description: VM Backup Server (Pihanga)
            widget:
              type: proxmoxbackupserver
              url: https://10.10.0.151:8007
              username: "{{HOMEPAGE_VAR_PBS_USERNAME}}"
              password: "{{HOMEPAGE_VAR_PBS_PASSWORD}}"

  widgets.yaml: |
    - logo:
        icon: https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Flag_of_Cornwall.svg/256px-Flag_of_Cornwall.svg.png
    - greeting:
        text_size: xl
        text: Kernow Homelab
    - datetime:
        text_size: l
        format:
          dateStyle: long
          timeStyle: short
          hourCycle: h23
        locale: en-GB
    - openmeteo:
        label: Cornwall
        latitude: 50.2660
        longitude: -5.0527
        timezone: Europe/London
        units: metric
        cache: 5
    - kubernetes:
        cluster:
          show: true
          cpu: true
          memory: true
          showLabel: true
          label: "Production"
        nodes:
          show: true
          cpu: true
          memory: true
          showLabel: true
    - unifi_console:
        url: https://10.10.0.51:11443
        username: "{{HOMEPAGE_VAR_UNIFI_USERNAME}}"
        password: "{{HOMEPAGE_VAR_UNIFI_PASSWORD}}"
    # --- NFS Storage Widgets ---
    - resources:
        label: "Plexopathy (Media)"
        disk: /mnt/plexopathy
        expanded: true
    - resources:
        label: "Tarriance (Downloads)"
        disk: /mnt/tarriance
        expanded: true
    - resources:
        label: "Taupo (HDD)"
        disk: /mnt/pleximetry
        expanded: true

  proxmox.yaml: |
    Ruapehu:
      url: https://10.10.0.10:8006
      token: root@pam!homepage
      secret: {{HOMEPAGE_VAR_API_TOKEN}}

    Pihanga:
      url: https://10.10.0.20:8006
      token: root@pam!homepage
      secret: {{HOMEPAGE_VAR_PIHANGA_API_TOKEN}}

    Hikurangi:
      url: https://10.30.0.10:8006
      token: mcp@pve!mcp-token
      secret: {{HOMEPAGE_VAR_HIKURANGI_API_TOKEN}}

  docker.yaml: ""

  custom.css: |
    /* Glassmorphism Theme for Homepage */

    /* Service and Bookmark Cards - Glass Effect */
    .service-card,
    .bookmark-card {
      background: rgba(15, 23, 42, 0.65) !important;
      backdrop-filter: blur(16px) saturate(180%);
      border: 1px solid rgba(148, 163, 184, 0.15) !important;
      border-radius: 12px !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Card Hover State */
    .service-card:hover,
    .bookmark-card:hover {
      background: rgba(30, 41, 59, 0.75) !important;
      border-color: rgba(148, 163, 184, 0.3) !important;
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4),
                  inset 0 1px 0 rgba(255, 255, 255, 0.15) !important;
    }

    /* Widget Cards - Enhanced Glass */
    .widget-card {
      background: rgba(15, 23, 42, 0.7) !important;
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(148, 163, 184, 0.2) !important;
      border-radius: 16px !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.35),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
    }

    /* Search Bar - Glass Effect */
    .search-container,
    input[type="text"],
    input[type="search"] {
      background: rgba(15, 23, 42, 0.6) !important;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(148, 163, 184, 0.2) !important;
      border-radius: 10px !important;
      color: rgba(241, 245, 249, 0.95) !important;
    }

    input[type="text"]:focus,
    input[type="search"]:focus {
      background: rgba(30, 41, 59, 0.7) !important;
      border-color: rgba(148, 163, 184, 0.4) !important;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2) !important;
    }

    /* Group Headers - Frosted Glass */
    .service-group-header,
    .bookmark-group-header {
      background: rgba(15, 23, 42, 0.5) !important;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(148, 163, 184, 0.15) !important;
      padding: 12px 16px !important;
      border-radius: 10px 10px 0 0 !important;
    }

    /* Sidebar - Glass Panel */
    .sidebar {
      background: rgba(15, 23, 42, 0.75) !important;
      backdrop-filter: blur(24px) saturate(180%);
      border-right: 1px solid rgba(148, 163, 184, 0.15) !important;
      box-shadow: 4px 0 24px rgba(0, 0, 0, 0.2) !important;
    }

    /* Status Indicators - Subtle Glow */
    .status-up {
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.4) !important;
    }

    .status-down {
      box-shadow: 0 0 8px rgba(239, 68, 68, 0.4) !important;
    }

    /* Links - Enhanced Readability */
    a {
      transition: all 0.2s ease-in-out;
    }

    a:hover {
      text-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
    }

    /* Resource Widgets - Refined Glass */
    .resource-widget {
      background: rgba(15, 23, 42, 0.65) !important;
      backdrop-filter: blur(14px);
      border: 1px solid rgba(148, 163, 184, 0.18) !important;
      border-radius: 12px !important;
    }

    /* Progress Bars - Glass Accent */
    .progress-bar {
      background: rgba(71, 85, 105, 0.3) !important;
      backdrop-filter: blur(8px);
      border-radius: 6px !important;
      overflow: hidden;
    }

    .progress-bar-fill {
      background: linear-gradient(90deg,
        rgba(59, 130, 246, 0.8),
        rgba(37, 99, 235, 0.9)) !important;
      box-shadow: 0 0 12px rgba(59, 130, 246, 0.5);
    }

    /* Text Contrast Enhancement */
    h1, h2, h3, h4, h5, h6 {
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
    }

    p, span, div {
      text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5);
    }

    /* Scrollbar - Glass Style */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.3);
      backdrop-filter: blur(8px);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(71, 85, 105, 0.6);
      backdrop-filter: blur(4px);
      border-radius: 5px;
      border: 2px solid transparent;
      background-clip: padding-box;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(100, 116, 139, 0.8);
    }

    /* Smooth Animations */
    * {
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Footer - Keep Hidden for Clean Look */
    footer {
      display: none;
    }

    /* Tab Navigation - Glass consistency */
    [role="tablist"] button,
    .tab-button {
      background: rgba(15, 23, 42, 0.5) !important;
      backdrop-filter: blur(12px) saturate(180%);
      border: 1px solid rgba(148, 163, 184, 0.15) !important;
      border-radius: 8px 8px 0 0 !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    [role="tablist"] button[aria-selected="true"],
    .tab-button.active {
      background: rgba(30, 41, 59, 0.8) !important;
      border-bottom-color: rgba(59, 130, 246, 0.6) !important;
      box-shadow: 0 -2px 12px rgba(59, 130, 246, 0.2) !important;
    }
    [role="tablist"] button:hover {
      background: rgba(30, 41, 59, 0.65) !important;
      border-color: rgba(148, 163, 184, 0.25) !important;
    }

  custom.js: ""
