# Cloudflare Tunnel ingresses for agentic cluster services
# With Homepage auto-discovery annotations
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: matrix-cloudflare
  namespace: apps
  annotations:
    gethomepage.dev/enabled: "true"
    gethomepage.dev/name: "Matrix"
    gethomepage.dev/group: "Agentic"
    gethomepage.dev/icon: "matrix.png"
    gethomepage.dev/description: "Matrix/Conduit Server"
    gethomepage.dev/pod-selector: ""
spec:
  ingressClassName: cloudflare-tunnel
  rules:
    - host: matrix.kernow.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: matrix-external
                port:
                  number: 80
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: langgraph-cloudflare
  namespace: apps
  annotations:
    gethomepage.dev/enabled: "true"
    gethomepage.dev/name: "LangGraph"
    gethomepage.dev/group: "Agentic"
    gethomepage.dev/icon: "mdi-graph"
    gethomepage.dev/description: "AI Orchestration"
    gethomepage.dev/pod-selector: ""
spec:
  ingressClassName: cloudflare-tunnel
  rules:
    - host: langgraph.kernow.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: langgraph-external
                port:
                  number: 80
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: vikunja-cloudflare
  namespace: apps
  annotations:
    gethomepage.dev/enabled: "true"
    gethomepage.dev/name: "Vikunja"
    gethomepage.dev/group: "Agentic"
    gethomepage.dev/icon: "vikunja"
    gethomepage.dev/description: "Task & Project Management"
    gethomepage.dev/pod-selector: ""
spec:
  ingressClassName: cloudflare-tunnel
  rules:
    - host: vikunja.kernow.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: vikunja-external
                port:
                  number: 80
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: claude-refresh-cloudflare
  namespace: apps
  annotations:
    gethomepage.dev/enabled: "true"
    gethomepage.dev/name: "Claude Refresh"
    gethomepage.dev/group: "Agentic"
    gethomepage.dev/icon: "mdi-key-change"
    gethomepage.dev/description: "Claude OAuth Token Refresh"
    gethomepage.dev/pod-selector: ""
spec:
  ingressClassName: cloudflare-tunnel
  rules:
    - host: claude-refresh.kernow.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: claude-refresh-external
                port:
                  number: 80
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: mcp-webhook-cloudflare
  namespace: apps
  annotations:
    gethomepage.dev/enabled: "false"
spec:
  ingressClassName: cloudflare-tunnel
  rules:
    - host: mcp-webhook.kernow.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: mcp-config-sync-external
                port:
                  number: 80
---
# Outline wiki - routed via nginx proxy that serves custom robots.txt
# and proxies all other requests to Outline (allows Claude crawlers)
# Note: Using port 31116 to directly reach the NodePort endpoint
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: outline-cloudflare
  namespace: apps
  annotations:
    gethomepage.dev/enabled: "true"
    gethomepage.dev/name: "Outline"
    gethomepage.dev/group: "Agentic"
    gethomepage.dev/icon: "outline.png"
    gethomepage.dev/description: "Wiki & Knowledge Base"
    gethomepage.dev/pod-selector: ""
spec:
  ingressClassName: cloudflare-tunnel
  rules:
    - host: outline.kernow.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: outline-external
                port:
                  number: 31116
