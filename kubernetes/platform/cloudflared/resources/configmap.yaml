---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cloudflared-config
  namespace: cloudflared
data:
  config.yaml: |
    tunnel: c1773e37-276a-4076-b3bb-043aec7975db
    credentials-file: /etc/cloudflared/creds/credentials.json
    metrics: 0.0.0.0:2000
    no-autoupdate: true

    ingress:
      # Catch-all for *.kernow.io
      - hostname: "*.kernow.io"
        service: https://traefik.traefik.svc.cluster.local:443
        originRequest:
          originServerName: kernow.io
          noTLSVerify: false
          http2Origin: true

      # Apex domain
      - hostname: kernow.io
        service: https://traefik.traefik.svc.cluster.local:443
        originRequest:
          originServerName: kernow.io
          noTLSVerify: false

      # 404 catch-all
      - service: http_status:404
