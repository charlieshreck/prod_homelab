# Sync Cloudflare API credentials from Infisical
# This secret provides the API credentials needed by the tunnel controller
# Uses secrets from /kubernetes/ path:
# - CLOUDFLARE_TUNNEL_API_TOKEN (API token)
# - CLOUDFLARE_ACCOUNT_ID (Cloudflare account ID)
# - CLOUDFLARE_TUNNEL_NAME (tunnel name)
apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: cloudflare-api
  namespace: cloudflare-tunnel-controller
spec:
  hostAPI: https://app.infisical.com/api

  authentication:
    universalAuth:
      credentialsRef:
        secretName: "universal-auth-credentials"
        secretNamespace: "infisical-operator-system"
      secretsScope:
        projectSlug: "prod-homelab-y-nij"
        envSlug: "prod"
        secretsPath: "/kubernetes"

  managedSecretReference:
    secretName: cloudflare-api-infisical
    secretNamespace: cloudflare-tunnel-controller
    secretType: Opaque
    creationPolicy: Owner
